<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz — GOC (Ajudante 3)</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --mute:#94a3b8; --acc:#22d3ee; --good:#22c55e; --bad:#ef4444;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue','Noto Sans',sans-serif}
  .wrap{max-width:980px;margin:40px auto;padding:0 16px}
  .card{background:linear-gradient(180deg,#0b1220 0,#0b1220ee 70%,#0b1220cc 100%),radial-gradient(1100px 500px at 110% -10%,#1f2937 0,#0b1220 60%);border:1px solid #1f2937;border-radius:18px;padding:20px 18px;box-shadow:0 10px 30px #0006}
  h1{font-size:1.6rem;margin:0 0 6px}
  .sub{color:var(--mute);margin:0 0 18px}
  select,button{font:inherit;color:var(--ink);background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:10px 12px}
  select:focus,button:focus{outline:2px solid var(--acc);outline-offset:2px}
  button.primary{background:#0b1220;border-color:#334155}
  button.primary:hover{border-color:#475569}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{display:inline-flex;gap:10px;align-items:center;background:#0b1220;border:1px solid #1f2937;border-radius:999px;padding:8px 12px;font-size:.95rem;color:var(--mute)}
  .q{margin:14px 0 18px;padding:16px;border:1px solid #1f2937;border-radius:14px;background:#0b1220b3}
  .q h3{font-size:1rem;margin:0 0 10px}
  .opts{display:grid;gap:8px}
  .opt{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid #1f2937;border-radius:10px;background:#0b1220}
  .opt input{margin-top:3px;accent-color:var(--acc)}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:600;font-size:.8rem}
  .ok{background:color-mix(in srgb, var(--good) 20%, transparent);border:1px solid var(--good);color:#bbf7d0}
  .ko{background:color-mix(in srgb, var(--bad) 15%, transparent);border:1px solid var(--bad);color:#fecaca}
  .explain{color:var(--mute);margin-top:8px;font-size:.94rem}
  .sticky{position:sticky;top:0;z-index:3;background:linear-gradient(#0f172a,#0f172aCC 80%,transparent);padding:10px 0 6px;margin:-10px 0 10px}
  .footer{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-top:16px}
  .counts{display:flex;gap:8px;flex-wrap:wrap}
  .k{border:1px solid #1f2937;border-radius:10px;padding:6px 10px;color:var(--mute)}
  .score{font-weight:700}
  .muted{color:var(--mute)}
  @media (prefers-reduced-motion:no-preference){ .q{transition:transform .15s ease, background .2s ease} .q:hover{transform:translateY(-1px)} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Quiz — GOC (Ajudante 3)</h1>
    <p class="sub">Responde às 25 questões e só no fim verás a correção e a nota (/20). Progresso guardado localmente.</p>

    <div class="row" style="margin-bottom:12px">
      <label for="testSel" class="pill">Escolher teste:
        <select id="testSel" style="margin-left:8px">
          <option value="GOC_AJ3">GOC — Ajudante 3</option>
        </select>
      </label>
      <button id="startBtn" class="primary">Começar / Reiniciar</button>
      <span class="pill">Progresso: <span id="prog">0/25</span></span>
      <span class="pill">Estado: <span id="state">Em resposta</span></span>
    </div>

    <div id="quizArea"></div>

    <div class="sticky">
      <div class="footer">
        <div class="counts">
          <span class="k">Certas: <strong id="cRight">0</strong></span>
          <span class="k">Erradas: <strong id="cWrong">0</strong></span>
          <span class="k">Em branco: <strong id="cBlank">25</strong></span>
          <span class="k score">Nota (/20): <strong id="score">–</strong></span>
        </div>
        <div class="row">
          <button id="submitBtn" class="primary">Entregar</button>
          <button id="exportBtn" title="Exportar resultados para .txt" disabled>Exportar .txt</button>
          <button id="clearBtn" title="Limpar progresso">Limpar</button>
        </div>
      </div>
    </div>

    <p class="muted" style="margin-top:8px">As perguntas e opções baralham a cada início. Progresso guardado localmente (por sessão).</p>
  </div>
</div>

<script>
function q(stem, options, correctIndex, explanation){ return { stem, options, correctIndex, explanation }; }
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}
function uid(){ return Math.random().toString(36).slice(2); }

const el = (q)=>document.querySelector(q);
const $quiz   = el('#quizArea');
const $prog   = el('#prog');
const $state  = el('#state');
const $score  = el('#score');
const $cRight = el('#cRight');
const $cWrong = el('#cWrong');
const $cBlank = el('#cBlank');
const $submit = el('#submitBtn');
const $start  = el('#startBtn');
const $export = el('#exportBtn');
const $clear  = el('#clearBtn');
const $sel    = el('#testSel');

let CURRENT = { testId:'GOC_AJ3', items:[], answers:{}, key:{}, locked:false, evaluated:false, seed:'' };
function storageKey(){ return `be_quiz_${CURRENT.testId}`; }
function saveState(){ localStorage.setItem(storageKey(), JSON.stringify({ answers:CURRENT.answers, seed:CURRENT.seed })); }
function loadState(){ const raw=localStorage.getItem(storageKey()); if(!raw) return null; try{return JSON.parse(raw);}catch{return null;} }

/* ---------- TESTE GOC — Ajudante 3 (25 perguntas) ---------- */
/* Regras: 30% V/F (8) com 50/50 (4V/4F) + 70% EM (17) com 4 opções */
const TEST_GOC_AJ3 = [
  // --- V/F (8) ---
  q("V/F — Conhecimento tácito é conhecimento pessoal, ligado a elementos intangíveis (valores, crenças, emoções e intuições).", ["Verdadeiro","Falso"], 0, "Slide 2."),
  q("V/F — Conhecimento explícito está formalizado em documentos/frases/regras e é facilmente transmitido (ex.: cursos e treinamentos).", ["Verdadeiro","Falso"], 0, "Slide 2."),
  q("V/F — Gestão do conhecimento pode ser definida como o processo de adquirir, distribuir e usar eficazmente o conhecimento.", ["Verdadeiro","Falso"], 0, "Slide 3."),
  q("V/F — Para os gregos, Chronos é o «momento certo» (oportuno) e Kairos é o tempo cronológico e mensurável.", ["Verdadeiro","Falso"], 1, "Slide 45."),
  q("V/F — Cultura organizacional corresponde apenas ao organigrama e aos processos formais de uma organização.", ["Verdadeiro","Falso"], 1, "Slide 14."),
  q("V/F — O fluxograma de processo não é indicado para estudar processos; serve apenas para apresentação visual.", ["Verdadeiro","Falso"], 1, "Slide 30."),
  q("V/F — Em benchmarking, o tipo competitivo procura as melhores práticas dentro da própria organização.", ["Verdadeiro","Falso"], 1, "Slide 39."),
  q("V/F — Nos erros de avaliação, o 'efeito de contraste' é um dos mais comuns.", ["Verdadeiro","Falso"], 0, "Slide 59."),

  // --- Escolha múltipla (17) ---
  q("Segundo o APQC, gestão do conhecimento é o processo de:", [
    "Identificar, adquirir e alavancar o conhecimento para aumentar a capacidade da empresa para competir",
    "Armazenar informação sem a partilhar internamente",
    "Eliminar o conhecimento tácito para reduzir custos",
    "Substituir a formação por tecnologia"
  ], 0, "Slide 4."),

  q("No entendimento geral, Cultura Organizacional é:", [
    "Conjunto de hábitos e crenças estabelecidos através de valores, normas e atitudes partilhadas",
    "Apenas um conjunto de regras escritas (regulamentos)",
    "A hierarquia formal e cadeia de comando",
    "O plano anual de atividades e orçamento"
  ], 0, "Slide 14."),

  q("Segundo Charles Handy, qual NÃO é um tipo de cultura organizacional listado?", [
    "Cultura do poder",
    "Cultura de papéis",
    "Cultura das tarefas",
    "Cultura da inovação"
  ], 3, "Slides 15–17."),

  q("As abordagens alternativas da gestão da mudança baseiam-se quase todas em:", [
    "Uso do poder; mudança racional; mudança pela reeducação",
    "Planeamento; execução; auditoria",
    "Motivação; recompensas; punições",
    "Estrutura; processos; tecnologia"
  ], 0, "Slides de gestão da mudança."),

  q("Modelagem de Processos (generalidades) tem, entre outros, o propósito de:", [
    "Criar uma representação completa e precisa do funcionamento do processo",
    "Substituir indicadores por descrições narrativas",
    "Eliminar por completo a necessidade de procedimentos",
    "Servir apenas para auditorias financeiras"
  ], 0, "Slide 28."),

  q("Um processo é (slide):", [
    "Uma sequência definida de atividades/etapas, executadas por equipamentos ou pessoas, com o objetivo de atingir uma meta",
    "Um conjunto de decisões sem entradas nem saídas",
    "Uma atividade isolada sem dependências",
    "Uma regra interna sem execução prática"
  ], 0, "Slide 29."),

  q("Os fluxogramas (diagramas de fluxo) são:", [
    "Uma representação gráfica das fases de um processo e das relações de dependência entre elas",
    "Uma lista de tarefas sem ligação entre si",
    "Um organigrama da organização",
    "Uma tabela de indicadores financeiros"
  ], 0, "Slide 30."),

  q("A notação BPMN pretende:", [
    "Eliminar as ambiguidades resultantes das diversas formas de representação gráfica de um processo",
    "Substituir a análise estratégica",
    "Eliminar a necessidade de processos",
    "Ser usada apenas em tecnologia"
  ], 0, "Slide 31."),

  q("Em benchmarking, o tipo interno corresponde a:", [
    "Procurar as melhores práticas dentro da própria organização",
    "Comparar apenas com concorrentes diretos",
    "Comparar funções em diferentes setores",
    "Comparar processos comuns independentemente do setor"
  ], 0, "Slide 39."),

  q("Em benchmarking, o tipo funcional é:", [
    "Relativo ao processo de trabalho das empresas, mesmo que de setores distintos, analisando funções (ex.: distribuição)",
    "Comparação apenas com concorrentes diretos",
    "Procura das melhores práticas dentro da organização",
    "Comparação multissetorial de aspetos funcionais e tarefas"
  ], 0, "Slide 39."),

  q("O ciclo PDCA corresponde a:", [
    "Plan, Do, Check, Act",
    "Prepare, Decide, Control, Assess",
    "Plan, Do, Control, Approve",
    "Prepare, Develop, Check, Align"
  ], 0, "Slide 40."),

  q("Para os gregos, o tempo definido por Chronos corresponde a:", [
    "Tempo cronológico/sequencial que pode ser medido",
    "O «momento certo» (oportuno)",
    "Um tempo indefinido onde algo especial acontece",
    "Um tempo apenas subjetivo"
  ], 0, "Slide 45."),

  q("Segundo o slide, gestão do tempo consiste em:", [
    "Registar, controlar e melhorar a utilização do nosso tempo",
    "Fazer mais tarefas em menos tempo sem planear",
    "Eliminar toda a planificação",
    "Delegar sempre todas as tarefas"
  ], 0, "Slide 46."),

  q("Principais fatores de gestão do tempo (slide) incluem:", [
    "Ambiente organizacional; ritmo de mudança; expetativas; perceção",
    "Orçamento; contabilidade; auditoria; inspeção",
    "Tecnologia; infraestruturas; frota; logística",
    "Hierarquia; disciplina; controlo; punição"
  ], 0, "Slide 47."),

  q("Delegar é (slide):", [
    "Dar a um subordinado a responsabilidade de um trabalho e decisões afins",
    "Transferir toda a responsabilidade e deixar de acompanhar",
    "Distribuir tarefas sem definir responsabilidades",
    "Dar instruções apenas por escrito e sem controlo"
  ], 0, "Slide 56."),

  q("Principais etapas da delegação (slide):", [
    "Analisar, Nomear, Instruir, Controlar, Avaliar",
    "Planear, Executar, Inspecionar, Punir, Arquivar",
    "Ouvir, Decidir, Registar, Comunicar, Encerrar",
    "Medir, Comparar, Corrigir, Validar, Certificar"
  ], 0, "Slide 57."),

  q("Qual destes é um erro comum de avaliação (slide)?", [
    "Efeito de halo",
    "Efeito de prioridade",
    "Efeito de normalização",
    "Efeito de padronização"
  ], 0, "Slide 59.")
];

let quizChangeHandler=null;

function build(testId){
  CURRENT.testId=testId;
  const base=TEST_GOC_AJ3;

  const seed=uid();
  CURRENT.seed=seed;

  const items = shuffle(base).map((qItem,i)=>{
    const idxMap = Array.from({length:qItem.options.length}, (_,k)=>k);
    const shuffledIdxs = shuffle(idxMap);
    const opts = shuffledIdxs.map(k=>qItem.options[k]);
    const correct = shuffledIdxs.indexOf(qItem.correctIndex);
    return {
      id:`${testId}-${i+1}`,
      stem:qItem.stem,
      opts:opts,
      correct:correct,
      explanation:qItem.explanation||''
    };
  });

  CURRENT.items = items.slice(0, 25);
  CURRENT.answers = {};
  CURRENT.key = Object.fromEntries(CURRENT.items.map(it=>[it.id,it.correct]));
  CURRENT.locked=false;
  CURRENT.evaluated=false;

  if(quizChangeHandler) $quiz.removeEventListener('change', quizChangeHandler);
  render();
  localStorage.removeItem(storageKey());
  updateCounts();
}

function render(){
  $quiz.innerHTML='';
  CURRENT.items.forEach((qItem, idx)=>{
    const wrap=document.createElement('div');
    wrap.className='q';
    wrap.dataset.qid=qItem.id;

    const h=document.createElement('h3');
    h.innerHTML=`<span class="muted">Q${idx+1}.</span> ${qItem.stem}`;

    const opts=document.createElement('div');
    opts.className='opts';

    qItem.opts.forEach((opt, i)=>{
      const id=`${qItem.id}-o${i}`;
      const line=document.createElement('label');
      line.className='opt';
      line.innerHTML=`
        <input type="radio" name="${qItem.id}" id="${id}" value="${i}">
        <div>${opt}</div>
      `;
      opts.appendChild(line);
    });

    wrap.appendChild(h);
    wrap.appendChild(opts);
    $quiz.appendChild(wrap);
  });

  $state.textContent='Em resposta';
  $score.textContent='–';
  $cRight.textContent='0';
  $cWrong.textContent='0';
  $cBlank.textContent=String(CURRENT.items.length);
  $export.disabled=true;

  quizChangeHandler=onSelect;
  $quiz.addEventListener('change', quizChangeHandler, { passive:true });
}

function onSelect(e){
  if(!e.target || e.target.type!=='radio') return;
  if(CURRENT.locked) return;
  const name=e.target.name;
  const val=Number(e.target.value);
  CURRENT.answers[name]=val;
  saveState();
  updateCounts();
}

function updateCounts(){
  const answered=Object.keys(CURRENT.answers).length;
  $prog.textContent=`${answered}/${CURRENT.items.length}`;
  $cBlank.textContent=String(CURRENT.items.length-answered);
}

function evaluate(){
  CURRENT.locked=true;
  CURRENT.evaluated=true;
  $state.textContent='Corrigido';
  let right=0, wrong=0;

  document.querySelectorAll('.q').forEach(qEl=>{
    const qid=qEl.dataset.qid;
    const item=CURRENT.items.find(x=>x.id===qid);
    const chosen=CURRENT.answers[qid];
    const correct=item.correct;

    const labels=qEl.querySelectorAll('.opt');
    labels.forEach((lab,i)=>{
      const input=lab.querySelector('input');
      input.disabled=true;
      if(i===correct) lab.classList.add('ok');
      if(chosen!==undefined && i===chosen && chosen!==correct) lab.classList.add('ko');
    });

    const badge=document.createElement('span');
    badge.className='badge ' + (chosen===correct ? 'ok' : 'ko');
    badge.textContent=(chosen===correct ? 'Correto' : (chosen===undefined ? 'Em branco' : 'Incorreto'));
    qEl.querySelector('h3').appendChild(document.createTextNode(' '));
    qEl.querySelector('h3').appendChild(badge);

    const exp=document.createElement('div');
    exp.className='explain';
    const correctTxt=item.opts[correct];

    if(chosen===correct) right++;
    else if(chosen===undefined) { /* branco */ }
    else wrong++;

    // Explicação só nas erradas/em branco, e curta
    const showExplain = (chosen!==correct) && item.explanation;
    exp.innerHTML = `<strong>Resposta correta:</strong> ${correctTxt}` + (showExplain ? ` — <em>${item.explanation}</em>` : ``);
    qEl.appendChild(exp);
  });

  const blanks=CURRENT.items.length-(right+wrong);
  const note20=(right/CURRENT.items.length)*20;
  $cRight.textContent=String(right);
  $cWrong.textContent=String(wrong);
  $cBlank.textContent=String(blanks);
  $score.textContent=note20.toFixed(1);
  $export.disabled=false;
  saveState();
}

function exportTxt(){
  const lines=[];
  lines.push(`Teste ${CURRENT.testId} — Resultados`);
  lines.push(`Certas: ${$cRight.textContent}`);
  lines.push(`Erradas: ${$cWrong.textContent}`);
  lines.push(`Em branco: ${$cBlank.textContent}`);
  lines.push(`Nota (/20): ${$score.textContent}`);
  lines.push('');
  CURRENT.items.forEach((it,i)=>{
    const chosen=CURRENT.answers[it.id];
    const mark=(chosen===undefined)?'—':String.fromCharCode(65+chosen);
    const ok=String.fromCharCode(65+it.correct);
    lines.push(`Q${i+1}. ${it.stem}`);
    it.opts.forEach((op,idx)=>{
      const tag=String.fromCharCode(65+idx);
      const sel=(idx===chosen)?'*':' ';
      const cor=(idx===it.correct)?' (correta)':'';
      lines.push(`  ${sel} ${tag}) ${op}${cor}`);
    });
    lines.push(`  → Tua resposta: ${mark} | Correta: ${ok}`);
    lines.push('');
  });
  const blob=new Blob([lines.join('\n')], {type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`resultado_teste_${CURRENT.testId}.txt`;
  a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 1000);
}

function clearProgress(){ localStorage.removeItem(storageKey()); build($sel.value); }

$start.addEventListener('click', ()=>build($sel.value));
$submit.addEventListener('click', ()=>{
  const answered=Object.keys(CURRENT.answers).length;
  if(answered<CURRENT.items.length){
    const remain=CURRENT.items.length-answered;
    if(!confirm(`Tens ${remain} pergunta(s) por responder. Queres entregar na mesma?`)) return;
  }
  evaluate();
});
$export.addEventListener('click', exportTxt);
$clear.addEventListener('click', clearProgress);
$sel.addEventListener('change', ()=>build($sel.value));

build($sel.value);
</script>
</body>
</html>
